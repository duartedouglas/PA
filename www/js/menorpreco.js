let categorias = '"{"totallooseoffers":0,"top5category":[{"top5category":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/587.jpg"},"hasoffer":false,"parentcategoryid":935,"isfinal":true,"name":"Vinho","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/vinho.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findProductList/4a567762457178412b52303d/br/?categoryId=587&sourceId=9262544"}}],"id":587}},{"top5category":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/1159.jpg"},"hasoffer":false,"parentcategoryid":935,"isfinal":true,"name":"Whisky","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/whisky.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findProductList/4a567762457178412b52303d/br/?categoryId=1159&sourceId=9262544"}}],"id":1159}},{"top5category":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/502.jpg"},"hasoffer":false,"parentcategoryid":935,"isfinal":true,"name":"Cerveja","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/cerveja.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findProductList/4a567762457178412b52303d/br/?categoryId=502&sourceId=9262544"}}],"id":502}},{"top5category":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/671.jpg"},"hasoffer":false,"parentcategoryid":614,"isfinal":true,"name":"Leite em Pó","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/leite-em-po.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findProductList/4a567762457178412b52303d/br/?categoryId=671&sourceId=9262544"}}],"id":671}},{"top5category":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/1158.jpg"},"hasoffer":false,"parentcategoryid":935,"isfinal":true,"name":"Vodka","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/vodka.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findProductList/4a567762457178412b52303d/br/?categoryId=1158&sourceId=9262544"}}],"id":1158}},{"top5category":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/2313.jpg"},"hasoffer":true,"parentcategoryid":9606,"isfinal":true,"name":"Café","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/cafe.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findOfferList/4a567762457178412b52303d/br/?categoryId=2313&sourceId=9262544"}}],"id":2313}},{"top5category":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/2138.jpg"},"hasoffer":false,"parentcategoryid":614,"isfinal":true,"name":"Leite","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/leite.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findProductList/4a567762457178412b52303d/br/?categoryId=2138&sourceId=9262544"}}],"id":2138}},{"top5category":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/939.jpg"},"hasoffer":false,"parentcategoryid":913,"isfinal":true,"name":"Refrigerante","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/refrigerante.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findProductList/4a567762457178412b52303d/br/?categoryId=939&sourceId=9262544"}}],"id":939}},{"top5category":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/5875.jpg"},"hasoffer":false,"parentcategoryid":490,"isfinal":true,"name":"Chocolate em Barra","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/chocolate-em-barra.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findProductList/4a567762457178412b52303d/br/?categoryId=5875&sourceId=9262544"}}],"id":5875}},{"top5category":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/691.jpg"},"hasoffer":false,"parentcategoryid":614,"isfinal":true,"name":"Queijo","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/queijo.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findProductList/4a567762457178412b52303d/br/?categoryId=691&sourceId=9262544"}}],"id":691}},{"top5category":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/1149.jpg"},"hasoffer":true,"parentcategoryid":935,"isfinal":true,"name":"Licor","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/licor.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findOfferList/4a567762457178412b52303d/br/?categoryId=1149&sourceId=9262544"}}],"id":1149}},{"top5category":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/1156.jpg"},"hasoffer":false,"parentcategoryid":935,"isfinal":true,"name":"Tequila","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/tequila.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findProductList/4a567762457178412b52303d/br/?categoryId=1156&sourceId=9262544"}}],"id":1156}},{"top5category":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/5883.jpg"},"hasoffer":false,"parentcategoryid":490,"isfinal":true,"name":"Bombom","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/bombom.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findProductList/4a567762457178412b52303d/br/?categoryId=5883&sourceId=9262544"}}],"id":5883}},{"top5category":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/1174.jpg"},"hasoffer":false,"parentcategoryid":913,"isfinal":true,"name":"Água Mineral","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/agua-mineral.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findProductList/4a567762457178412b52303d/br/?categoryId=1174&sourceId=9262544"}}],"id":1174}},{"top5category":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/2254.jpg"},"hasoffer":false,"parentcategoryid":9606,"isfinal":true,"name":"Arroz","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/arroz.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findProductList/4a567762457178412b52303d/br/?categoryId=2254&sourceId=9262544"}}],"id":2254}},{"top5category":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/3265.jpg"},"hasoffer":false,"parentcategoryid":517,"isfinal":true,"name":"Cereal / Proteína em Barra","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/cereal-proteina-em-barra.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findProductList/4a567762457178412b52303d/br/?categoryId=3265&sourceId=9262544"}}],"id":3265}}],"details":{"applicationpath":"","date":{"valid":true,"eonandyear":{"lowestsetbit":5},"hour":20,"month":5,"year":2016,"timezone":-180,"millisecond":840,"xmlschematype":{"prefix":"","localpart":"dateTime","namespaceuri":"http://www.w3.org/2001/XMLSchema"},"day":17,"minute":29,"second":2},"code":0,"applicationversion":"1.0","elapsedtime":2,"applicationid":"4a567762457178412b52303d","message":"success","status":"success"},"totalresultsavailable":13,"totalresultsreturned":13,"subcategory":[{"subcategory":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/935.jpg"},"parentcategoryid":486,"isfinal":false,"name":"Bebida Alcoólica","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/bebida-alcoolica.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}}],"id":935}},{"subcategory":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/913.jpg"},"parentcategoryid":486,"isfinal":false,"name":"Bebida Não Alcoólica","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/bebida-nao-alcoolica.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}}],"id":913}},{"subcategory":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/487.jpg"},"parentcategoryid":486,"isfinal":false,"name":"Bomboniere","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/bomboniere.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}}],"id":487}},{"subcategory":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/918.jpg"},"parentcategoryid":486,"isfinal":false,"name":"Carnes","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/carnes.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}}],"id":918}},{"subcategory":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/2323.jpg"},"hasoffer":true,"parentcategoryid":486,"isfinal":true,"name":"Cesta Básica","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/cesta-basica.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findOfferList/4a567762457178412b52303d/br/?categoryId=2323&sourceId=9262544"}}],"id":2323}},{"subcategory":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/930.jpg"},"parentcategoryid":486,"isfinal":false,"name":"Congelados","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/congelados.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}}],"id":930}},{"subcategory":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/912.jpg"},"parentcategoryid":486,"isfinal":false,"name":"Hortifrutigranjeiros","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/hortifrutigranjeiros.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}}],"id":912}},{"subcategory":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/614.jpg"},"parentcategoryid":486,"isfinal":false,"name":"Laticínios","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/laticinios.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}}],"id":614}},{"subcategory":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/517.jpg"},"parentcategoryid":486,"isfinal":false,"name":"Matinais","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/matinais.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}}],"id":517}},{"subcategory":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/564.jpg"},"parentcategoryid":486,"isfinal":false,"name":"Mercearia","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/mercearia.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}}],"id":564}},{"subcategory":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/917.jpg"},"parentcategoryid":486,"isfinal":false,"name":"Padaria / Confeitaria","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/padaria-confeitaria.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}}],"id":917}},{"subcategory":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/500.jpg"},"hasoffer":false,"parentcategoryid":486,"isfinal":true,"name":"Papinha para Bebê","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/papinha-para-bebe.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findProductList/4a567762457178412b52303d/br/?categoryId=500&sourceId=9262544"}}],"id":500}},{"subcategory":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/910.jpg"},"parentcategoryid":486,"isfinal":false,"name":"Sobremesas / Confeitaria","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/sobremesas-confeitaria.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}}],"id":910}}],"category":{"concatenatecategoryname":false,"thumbnail":{"url":"http://imagem.buscape.com.br/bp5/categorias/486.jpg"},"hasoffer":true,"parentcategoryid":0,"isfinal":false,"name":"Alimentos e Bebidas","links":[{"link":{"type":"category","url":"http://www.buscape.com.br/alimentos-e-bebidas.html?mdsrc=9262544&mdapp=7872&mddtn=51922611"}},{"link":{"type":"xml","url":"http://sandbox.buscape.com.br/service/findOfferList/4a567762457178412b52303d/br/?categoryId=486&sourceId=9262544"}}],"id":486}}"';

let mpCategorias = Vue.extend({
    template: '#categorias-tpl',
    data:{
        "categorias":categorias
    },
    methods:{

    }
});
Vue.component('mp-categorias', mpCategorias);

new Vue({
	el: '#main',
	data: {
        keyword: "",
		layout: 'grid1',
        inputFocus:false,
        autocomplete:[],
        produtos: []
	},
    ready(){
      this.autocomplete = [];
      let lista = JSON.parse(localStorage.getItem('list'));
      if (lista){
         this.produtos = lista;
      }
    },
    methods:{
    
        addList(p, e){
            if(e.target.classList.contains('_block')){
                return;
            }
            this.keyword = '';
            e.target.classList.add('_block');
            this.produtos.push(p);
            localStorage.setItem('list', JSON.stringify(this.produtos));
        },
        remover(p){
            this.produtos.$remove(p);
            localStorage.setItem('list', JSON.stringify(this.produtos));
        },
        search(e){
            e.preventDefault();
            this.inputFocus = (this.keyword.length > 0);

            if (this.keyword.length < 3) return;

            const url = "http://sandbox.buscape.com.br/service/findProductList/4a567762457178412b52303d/?format=json&";
            var keyword  = this.keyword.trim(),
                keyword = keyword.replace(/\s+/g, "+"),
                params = "keyword=" + keyword;
            //fetch(url + params)
            //.then(response => response.json() )
            $.getJSON(url + params)
            .then((json) => {
                data = json.product;
                this.autocomplete = data;
            }).fail(function(ex) {
                console.log('erro', ex);
            });
        }
    }
});